{"mappings":"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","sources":["src/index.ts"],"sourcesContent":["/**!\n * Core Web Vitals in Google Analytics for Shopify\n * https://github.com/RenderBetter/web-vitals-google-analytics-shopify\n *\n * Copyright (c) Render Better.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport * as webVitals from 'web-vitals';\nimport type {Metric} from 'web-vitals';\n\ntype GoogleAnalyticsFunction = (...args: unknown[]) => void;\n\ndeclare const window: Window & {\n    ga?: GoogleAnalyticsFunction;\n    gtag?: GoogleAnalyticsFunction;\n    trekkie?: {\n        config: {\n            'Google Analytics': {\n                trackingId: string;\n            };\n            'Google Gtag Pixel': {};\n        };\n    };\n    dataLayer: [unknown[]];\n};\n\nwindow.dataLayer = window.dataLayer || [];\n\nconst isUAEnabled = function () {\n    return (\n        window.trekkie &&\n        window.trekkie.config &&\n        window.trekkie.config['Google Analytics'] &&\n        window.trekkie.config['Google Analytics'].trackingId &&\n        window.trekkie.config['Google Analytics'].trackingId.startsWith('UA-')\n    );\n};\n\nconst isGA4Enabled = function () {\n    return window.trekkie && window.trekkie.config && window.trekkie.config['Google Gtag Pixel'];\n};\n\nconst round = function (num: number, decimals: number) {\n    return +(Math.round(+(num.toFixed(decimals) + 'e+' + decimals)) + 'e-' + decimals);\n};\n\nconst currentScript = document.currentScript as HTMLScriptElement;\n\nconst sendMetricToGa = function (metric: {name: Metric['name']; value: Metric['value']}) {\n    const attributes = currentScript?.dataset || {};\n\n    const shopifyTemplate: string | undefined = attributes.shopifyTemplate;\n    const actionPrefix = attributes.eventActionPrefix || 'Web Performance: ';\n    const metricDecimalPlaces = Number(attributes.metricDecimalPlaces) || 3;\n\n    const eventCategory = attributes.eventCategory || 'Web Performance';\n    const eventAction = `${actionPrefix}${metric.name}`;\n    const eventValue =\n        metric.name !== 'CLS'\n            ? round(metric.value / 1000, metricDecimalPlaces)\n            : round(metric.value, metricDecimalPlaces);\n\n    const debug = 'debug' in attributes;\n    const debugLog = (message: string, data?: unknown) => {\n        if (debug) {\n            console.log(`[web-vitals-google-analytics-shopify] ${message}`, data);\n        }\n    };\n\n    debugLog('Collecting', metric);\n\n    // UA data collection model: https://support.google.com/analytics/answer/11091422#universal-analytics\n    // event fields: https://developers.google.com/analytics/devguides/collection/analyticsjs/events#event_fields\n    const uaEventUsingAnalyticsJs = {\n        hitType: 'event',\n        eventCategory,\n        eventAction, // LCP, CLS, FID, etc.\n        eventLabel: shopifyTemplate || null,\n        eventValue: Math.round(Number(eventValue) * 1000), // analytics.js requires integer values\n        nonInteraction: true,\n        transport: 'beacon',\n    };\n\n    // GTag event model: https://developers.google.com/analytics/devguides/collection/gtagjs/events\n    // https://developers.google.com/analytics/devguides/migration/ua/analyticsjs-to-gtagjs\n    const uaEventUsingGtagJs = {\n        event_category: eventCategory,\n        event_label: shopifyTemplate || null,\n        value: eventValue,\n        non_interaction: true,\n        transport: 'beacon',\n    };\n\n    // GA4 event model: https://developers.google.com/analytics/devguides/collection/ga4/events\n    // https://support.google.com/analytics/answer/11091026#gtag-dual-tagging\n    const ga4EventUsingGtagJs = {\n        event_category: eventCategory,\n        shopify_template: shopifyTemplate,\n        value: eventValue,\n    };\n\n    if (isUAEnabled()) {\n        // Send UA event\n        if (window.gtag) {\n            // Send UA event using gtag function\n            window.gtag('event', eventAction, uaEventUsingGtagJs);\n            debugLog('Sent UA event using gtag function', uaEventUsingGtagJs);\n        } else if (window.ga) {\n            // Send UA event using analytics.js\n            window.ga('send', uaEventUsingAnalyticsJs);\n            debugLog('Sent UA event using ga function', uaEventUsingAnalyticsJs);\n        } else {\n            // Push UA event to dataLayer and assume analytics.js data collection model\n            window.dataLayer.push(['event', uaEventUsingAnalyticsJs]);\n            debugLog('Pushed UA event analytics.js event into dataLayer', uaEventUsingGtagJs);\n        }\n    } else if (isGA4Enabled()) {\n        // Send GA4 event\n        if (window.gtag) {\n            // Send GA4 event using gtag function\n            window.gtag('event', eventAction, ga4EventUsingGtagJs);\n            debugLog('Sent GA4 event using gtag function', ga4EventUsingGtagJs);\n        } else {\n            // Push GA4 event to dataLayer and assume gtag.js data collection model\n            window.dataLayer.push(['event', ga4EventUsingGtagJs]);\n            debugLog('Pushed GA4 event gtag.js event into dataLayer', ga4EventUsingGtagJs);\n        }\n    } else if (window.gtag) {\n        // Assume a UA model and send UA event using gtag function\n        // GA4 will convert the fields: https://support.google.com/analytics/answer/11091026#gtag-dual-tagging\n        window.gtag('event', eventAction, uaEventUsingGtagJs);\n        debugLog('Sent UA event using gtag function (unknown GA installation)', uaEventUsingGtagJs);\n    } else {\n        // Assume a UA model and push UA event into dataLayer\n        // GA4 will convert the fields: https://support.google.com/analytics/answer/11091026#gtag-dual-tagging\n        window.dataLayer.push(['event', uaEventUsingAnalyticsJs]);\n        debugLog('Pushed UA event gtag.js event into dataLayer (unknown GA installation)', uaEventUsingGtagJs);\n    }\n};\n\nwebVitals.onLCP(sendMetricToGa);\nwebVitals.onCLS(sendMetricToGa);\nwebVitals.onFID(sendMetricToGa);\nwebVitals.onINP(sendMetricToGa);\nwebVitals.onTTFB(sendMetricToGa);\n\nexport {};\n"],"names":[],"version":3,"file":"web-vitals-google-analytics-shopify.mjs.js.map"}